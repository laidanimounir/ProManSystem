<Window x:Class="ProManSystem.Views.PurchaseInvoiceEditWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="تعديل فاتورة الشراء"
        Height="650" Width="1000"
        WindowStartupLocation="CenterOwner"
        Background="#F3F4F6"
        FlowDirection="RightToLeft">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="60"/>
        </Grid.RowDefinitions>

        
        <Border Grid.Row="0" Background="White" Padding="16" Margin="0,0,0,8"
                BorderBrush="#E5E7EB" BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="1" Orientation="Vertical" HorizontalAlignment="Right">
                    <TextBlock Text="تعديل فاتورة الشراء"
                               FontSize="18" FontWeight="SemiBold"
                               Foreground="#111827"/>
                    <TextBlock Text="قم بتحديث بيانات الفاتورة والبنود ثم احفظ التغييرات."
                               FontSize="11" Foreground="#6B7280" Margin="0,4,0,0"/>
                </StackPanel>

                <StackPanel Grid.Column="0" Orientation="Vertical" HorizontalAlignment="Left">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="رقم:" FontWeight="Bold" Margin="0,0,4,0"/>
                        <TextBlock Text="{Binding Text, ElementName=NumeroFactureTextBox, Mode=OneWay}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                        <TextBlock Text="تاريخ:" FontWeight="Bold" Margin="0,0,4,0"/>
                        <TextBlock Text="{Binding SelectedDate, ElementName=DateFactureDatePicker, StringFormat={}{0:dd/MM/yyyy}}"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

       
        <Grid Grid.Row="1" Margin="16,0,16,8">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="8"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

         
            <Border Grid.Row="0" Background="White" CornerRadius="8"
                    Padding="14" BorderBrush="#E5E7EB" BorderThickness="1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                   
                    <StackPanel Grid.Column="0" Margin="0,0,12,0">
                        <TextBlock Text="المورد" FontWeight="Bold" FontSize="12" Margin="0,0,0,4"/>
                        <TextBox x:Name="SupplierTextBox"
                                 Height="30" Padding="6"
                                 IsReadOnly="True"
                                 BorderBrush="#D1D5DB"/>
                    </StackPanel>

                    
                    <StackPanel Grid.Column="1" Margin="0,0,12,0">
                        <TextBlock Text="رقم الفاتورة" FontWeight="Bold" FontSize="12" Margin="0,0,0,4"/>
                        <TextBox x:Name="NumeroFactureTextBox"
                                 Height="30" Padding="6"
                                 IsReadOnly="True"
                                 BorderBrush="#D1D5DB"/>
                        <TextBlock Text="تاريخ الفاتورة" FontWeight="Bold" FontSize="12" Margin="0,10,0,4"/>
                        <DatePicker x:Name="DateFactureDatePicker"
                                    Height="30"
                                    BorderBrush="#D1D5DB"/>
                    </StackPanel>

                   
                    <StackPanel Grid.Column="2">
                        <TextBlock Text="ملاحظات" FontWeight="Bold" FontSize="12" Margin="0,0,0,4"/>
                        <TextBox x:Name="NotesTextBox"
                                 Height="70" TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto"
                                 BorderBrush="#D1D5DB" Padding="4"/>
                    </StackPanel>
                </Grid>
            </Border>

            
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="3*"/>
                    <ColumnDefinition Width="220"/>
                </Grid.ColumnDefinitions>

                
                <Border Grid.Column="0" Background="White" CornerRadius="8"
                        Padding="10" BorderBrush="#E5E7EB" BorderThickness="1" Margin="0,0,8,0">
                    <StackPanel>
                        <TextBlock Text="البنود" FontWeight="Bold" FontSize="13" Margin="0,0,0,6"/>
                        <DataGrid x:Name="PurchaseInvoicesGrid"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  HeadersVisibility="Column"
                                  RowHeight="28"
                                  AlternatingRowBackground="#F9FAFB"
                                  GridLinesVisibility="Horizontal"
                                  HorizontalGridLinesBrush="#E5E7EB"
                                  BorderThickness="0">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="#111827"/>
                                    <Setter Property="Foreground" Value="White"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="FontSize" Value="12"/>
                                    <Setter Property="Padding" Value="6,3"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>

                            <DataGrid.Columns>
                                <DataGridTextColumn Header="المادة"
                                                    Binding="{Binding RawMaterial.Designation}"
                                                    IsReadOnly="True" Width="*"/>
                                <DataGridTextColumn Header="الكمية"
                                                    Binding="{Binding Quantite, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                    Width="80"/>
                                <DataGridTextColumn Header="السعر للوحدة"
                                                    Binding="{Binding PrixUnitaire, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N2}}"
                                                    Width="110"/>
                                <DataGridTextColumn Header="المجموع"
                                                    Binding="{Binding MontantLigne, Mode=OneWay, StringFormat={}{0:N2}}"
                                                    IsReadOnly="True" Width="110"/>
                            </DataGrid.Columns>
                        </DataGrid>
                        <TextBlock Text="يمكن تعديل الكمية والسعر مباشرة داخل الجدول."
                                   FontSize="11" Foreground="#6B7280" Margin="0,6,0,0"/>
                    </StackPanel>
                </Border>

                
                <Border Grid.Column="1" Background="White" CornerRadius="8"
                        Padding="12" BorderBrush="#E5E7EB" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="الإجماليات" FontWeight="Bold" FontSize="13" Margin="0,0,0,8"/>

                        <Grid Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="110"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="الإجمالي بدون ضريبة (HT):"
                                       FontSize="11" VerticalAlignment="Center" HorizontalAlignment="Right"/>
                            <TextBox Grid.Column="1" x:Name="TotalHTTextBox"
                                     Height="24" IsReadOnly="True"
                                     Padding="4" FontSize="11"
                                     BorderBrush="#D1D5DB" Margin="6,0,0,0"/>
                        </Grid>

                        <Grid Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="110"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="الضريبة (TVA 19%):"
                                       FontSize="11" VerticalAlignment="Center" HorizontalAlignment="Right"/>
                            <TextBox Grid.Column="1" x:Name="TVATextBox"
                                     Height="24" IsReadOnly="True"
                                     Padding="4" FontSize="11"
                                     BorderBrush="#D1D5DB" Margin="6,0,0,0"/>
                        </Grid>

                        <Separator Margin="0,4"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="110"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="الإجمالي مع الضريبة (TTC):"
                                       FontSize="12" FontWeight="Bold"
                                       VerticalAlignment="Center" HorizontalAlignment="Right"/>
                            <TextBox Grid.Column="1" x:Name="TotalTTCTextBox"
                                     Height="26" IsReadOnly="True"
                                     Padding="4" FontSize="11" FontWeight="Bold"
                                     BorderBrush="#16A34A" BorderThickness="1"
                                     Background="#ECFDF5" Margin="6,0,0,0"/>
                        </Grid>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>

        
        <Border Grid.Row="2" Background="White" Padding="16,8" BorderBrush="#E5E7EB" BorderThickness="1,0,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="بعد حفظ التعديلات يمكنك طباعة الفاتورة من شاشة التاريخ."
                           VerticalAlignment="Center" Foreground="#6B7280" FontSize="11"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="حفظ التعديلات"
                            Click="SaveButton_Click"
                            Width="140" Height="34"
                            Margin="0,0,8,0"
                            Background="#16A34A" Foreground="White"
                            FontWeight="SemiBold" FontSize="11"/>
                    <Button Content="إلغاء"
                            Click="CancelButton_Click"
                            Width="100" Height="34"
                            Background="#EF4444" Foreground="White"
                            FontSize="11"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
